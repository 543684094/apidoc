接口文档
========

·无基本参数

·基本返回内容如下

·收发格式默认JSON

返回格式如下

```python
{

“Err_No”: “0”,

“Err_Msg”: “ok”

}
带数据

{

“Err_No”: “0”,

“Err_Msg”: “ok”,

“Data”: [{},],

“Total_Numbers”：“”

}
```

**1.用户相关**
------------------

### 1.1 用户注册

**URL**

/api/users

>   （生成用户唯一主题，mqtt登录密码，个人信息添加，建立用户数据库）

**请求方法**

POST

**请求参数**

| 参数名            | 类型 | 是否必须 | 参数说明     |
|-------------------|------|----------|--------------|
| Usr_Name          | str  | 是       | 用户名称     |
| Usr_Password      | str  | 是       | 用户密码     |
| Usr_Email         | str  | 是       | 用户邮箱     |
| Usr_MQTT_Password | str  | 是       | mqtt密码     |
| Usr_Phone         | str  | 否       | 用户联系方式 |
| Usr_Company       | str  | 否       | 公司         |
| Usr_Description   | str  | 否       | 用户描述     |

**返回参数**

### 1.2 用户登录

**URL**

/api/auth

**请求方法**

POST

**请求参数**

| 参数名       | 类型 | 是否必须 | 参数说明 |
|--------------|------|----------|----------|
| Usr_Name     | str  | 是       |          |
| Usr_Password | str  | 是       |          |

**返回参数**

| 参数名       | 类型 | 参数说明     |
|--------------|------|--------------|
| Usr_Name     | str  | 用户名       |
| Usr_ID       | str  | 用户唯一标识 |
| Is_Superuser | int  | 0,1          |
| Is_Firm      | int  | 0,1          |

### 1.3 获取用户个人信息

**URL**

/api/users

**请求方法**

GET

**请求参数**

无

**返回参数**

| 参数名           | 类型 | 参数说明                             |
|------------------|------|--------------------------------------|
| Usr_Name         | str  | 用户名                               |
| Usr_State        | str  | 用户是否激活，默认激活               |
| Usr_ID           | str  | 用户唯一标识                         |
| Usr_Email        | str  |                                      |
| Usr_Company      | str  |                                      |
| Usr_Phone        |      |                                      |
| Usr_Description  | str  | 描述                                 |
| Usr_MQTT_Subject | str  |                                      |
| Is_Superuser     | int  | 0,1                                  |
| Is_Firm          | int  | 0,1,1表示是厂商用户，0表示是普通用户 |

### 1.4 获取当前公司所有用户信息

**URL**

/api/allusers

**请求方法**

GET

**请求参数**

无

**返回参数**

| 参数名           | 类型 | 参数说明               |
|------------------|------|------------------------|
| Usr_Name         | str  | 用户名                 |
| Usr_State        | str  | 用户是否激活，默认激活 |
| Usr_ID           | str  | 用户唯一标识           |
| Usr_Email        | str  |                        |
| Usr_Company      | str  |                        |
| Usr_Phone        |      |                        |
| Usr_Description  | str  | 描述                   |
| Usr_MQTT_Subject | str  |                        |
| Is_Superuser     | int  | 0,1                    |

### 1.5修改用户个人信息

**URL**

/api/users

**请求方法**

PUT

**请求参数**

| 参数名          | 类型 | 是否必须 | 参数说明     |
|-----------------|------|----------|--------------|
| Usr_Name        | str  | 是       |              |
| Usr_ID          | str  | 是       | 用户唯一标识 |
| Usr_Email       | str  | 是       |              |
| Usr_Phone       | str  | 否       |              |
| Usr_Company     | str  | 否       | 公司         |
| Usr_Description | str  | 否       |              |

**返回参数**

###  1.5.1删除用户

**URL**

/api/users

**请求方法**

DELETE

**请求参数**

| 参数名   | 类型 | 是否必须 | 参数说明     |
|----------|------|----------|--------------|
| Usr_Name | str  | 是       |              |
| Usr_ID   | str  | 是       | 用户唯一标识 |

**返回参数**

###  1.5.2修改用户密码

**URL**

/api/modifyPassword

**请求方法**

POST

**请求参数**

| 参数名          | 类型 | 是否必须 | 参数说明     |
|-----------------|------|----------|--------------|
| Usr_Name        | str  | 否       |              |
| Usr_ID          | str  | 是       | 用户唯一标识 |
| Origin_Password | str  | 是       | 原始密码     |
| Usr_Password    | str  | 是       | 密码         |

**返回参数**

### 1.6退出登录

**URL**

/api/auth

**请求方法**

DELETE

**请求参数**

**返回参数**

### 用户日志

### 1.7.1 获取用户日志

**URL**

/api/userlogs

**请求方法**

GET

**请求参数**

| 参数名          | 类型 | 是否必须 | 参数说明                                 |
|-----------------|------|----------|------------------------------------------|
| Start_Date      | str  | 否       | 默认当天0点，格式："2019-04-01 13:53:59" |
| End_Date        | str  | 否       | 默认当前时间，格式:"2019-04-01 13:53:59" |
| Order_By        | str  | 否       | 默认以TimeStamp排序                      |
| Order_Way       | str  | 否       | ‘asc’,’desc’,默认desc                    |
| Limits          | str  | 否       | 数据条数，默认所有                       |
| Usr_ID          | str  | 是       | 用户id                                   |
| Per_Page_Counts | int  | 否       | 默认20                                   |
| Page_Counts     | int  | 否       | 默认0代表所有                            |
| Usr_Name        | str  | 否       | 默认所有，可以多选，‘,’相连              |
| Module          | str  | 否       | 默认所有，可以多选，‘,’相连              |
| Result          | str  | 否       | 默认所有，可以多选，‘,’相连              |

**返回参数**

| 参数名    | 类型 | 参数说明                                                           |
|-----------|------|--------------------------------------------------------------------|
| Timestamp | str  | 时间                                                               |
| Usr_Name  | str  | 用户名，可以为空                                                   |
| Module    | str  | 操作的模块，分为'用户'、'设备'、'测点'、'数据'、'数据库'，可以为空 |
| Detail    | str  | 详细操作内容，可以为空                                             |
| Result    | str  | 操作结果，共3种'成功'、'异常'、'告警'，不能为空                    |
| Message   | str  | 结果说明，可以为空                                                 |

### 1.7.2 发送日志

**URL**

/api/userlogs

**请求方法**

POST

**请求参数**

| 参数名  | 类型 | 是否必须 | 参数说明                           |
|---------|------|----------|------------------------------------|
| Module  | str  | 是       | 日志模块                           |
| Detail  | str  | 是       | 日志操作内容                       |
| Result  | str  | 是       | 日志操作结果，'成功','异常','告警' |
| Message | str  | 是       | 结果信息说明                       |

**返回参数**

### 用户权限

### 1.8.1 获取用户权限

**URL**

/api/userpermission

**请求方法**

GET

**请求参数**

| 参数名   | 类型 | 是否必须 | 参数说明 |
|----------|------|----------|----------|
| Usr_ID   | str  | 是       | 用户id   |
| Usr_Name | str  | 是       | 用户名称 |

**返回参数**

| 参数名          | 类型 | 参数说明               |
|-----------------|------|------------------------|
| Usr_ID          |      |                        |
| Usr_Name        |      |                        |
| 权限值1。。。。 | str  | 1为有权限，0为没有权限 |
| 权限值n。。。。 | str  | 1为有权限，0为没有权限 |

### 1.8.2 更改用户权限

**URL**

/api/userpermission

**请求方法**

PUT

**请求参数**

| 参数名          | 类型 | 是否必须 | 参数说明               |
|-----------------|------|----------|------------------------|
| Usr_ID          | str  | 是       | 用户id                 |
| Usr_Name        | str  | 是       | 用户名称               |
| 权限值1。。。。 | str  | 是       | 1为有权限，0为没有权限 |
| 权限值n。。。。 | str  | 是       | 1为有权限，0为没有权限 |

### 1.9 获取使用某品牌的所有公司列表

**URL**

/api/allusers_by_brand

**请求方法**

GET

**请求参数**

| 参数名    | 类型 | 是否必须 | 参数说明                  |
|-----------|------|----------|---------------------------|
| Dev_Brand | str  | 否       | 品牌名称,不传返回所有公司 |

**返回参数**

| 参数名      | 类型 | 参数说明 |
|-------------|------|----------|
| Usr_Company | str  | 公司名称 |
| Usr_ID      | str  | 公司ID   |

### 1.10 获取指定用户的平台页面展示权限

**URL**

/api/user_page_permission

**请求方法**

GET

**请求参数**

| 参数名   | 类型 | 是否必须 | 参数说明 |
|----------|------|----------|----------|
| Usr_ID   | str  | 是       | 用户id   |
| Usr_Name | str  | 是       | 用户名称 |

**返回参数**

| 参数名          | 类型 | 参数说明               |
|-----------------|------|------------------------|
| Usr_ID          |      |                        |
| Usr_Name        |      |                        |
| 权限值1。。。。 | str  | 1为有权限，0为没有权限 |
| 权限值n。。。。 | str  | 1为有权限，0为没有权限 |

### 1.11 修改指定用户的平台页面展示权限

**URL**

/api/user_page_permission

**请求方法**

PUT

**请求参数**

| 参数名   | 类型 | 是否必须 | 参数说明 |
|----------|------|----------|----------|
| Usr_ID   | str  | 是       | 用户id   |
| Usr_Name | str  | 是       | 用户名称 |

**返回参数**

| 参数名          | 类型 | 参数说明               |
|-----------------|------|------------------------|
| Usr_ID          |      |                        |
| Usr_Name        |      |                        |
| 权限值1。。。。 | str  | 1为有权限，0为没有权限 |
| 权限值n。。。。 | str  | 1为有权限，0为没有权限 |

2.设备相关
--------------

### 2.1.1添加设备

**URL**

/api/devs

**请求方法**

POST

**请求参数**

| 参数名          | 类型 | 是否必须 | 参数说明                   |
|-----------------|------|----------|----------------------------|
| Usr_ID          | str  | 否       | 默认本用户                 |
| Dev_Name        | str  | 是       | 设备名                     |
| Dev_ID          | str  | 是       | 设备唯一ID                 |
| Dev_Description | str  | 否       | 设备描述                   |
| Dev_Brand       | str  | 否       | 设备所属品牌，用户可选可填 |

**返回参数**

设备task_id

### 2.1.2复制设备

**URL**

/api/copy_devs

**请求方法**

POST

**请求参数**

| 参数名              | 类型 | 是否必须 | 参数说明   |
|---------------------|------|----------|------------|
| Usr_ID              | str  | 否       | 默认本用户 |
| Dev_ID              | str  | 是       | 设备ID     |
| Copy_Number         | int  | 是       | 生成数量   |
| Prefix_Name         | str  | 是       | 前缀名     |
| Suffix_Start_Number | int  | 是       | 后缀起始值 |

**返回参数**

### 2.2.1添加设备测点（生成设备数据记录表）

**URL**

/api/measurePoints

**请求方法**

POST

**请求参数**

| 参数名               | 类型 | 是否必须 | 参数说明                                                         |
|----------------------|------|----------|------------------------------------------------------------------|
| Usr_ID               | str  | 否       | 默认本用户                                                       |
| Dev_ID               | str  | 是       | 设备id                                                           |
| Measure_Name         | str  | 是       | 测点名                                                           |
| MeasureDataFlow_Name | str  | 是       | 数据流名称                                                       |
| Measure_DataType     | str  | 是       | 测点数据类型，0：状态值；1：数据值                               |
| Measure_TotalState   | str  | 否       | 测点值统计，0：不记录；1：记录，默认0                            |
| Measure_SwitchState  | str  | 否       | '1'表示该测点为开关测点，默认为'0',已有开关测点添加值为'1'会失败 |
| Measure_Unit         | str  | 否       | 数据单位，默认为空                                               |
| Measure_Descriptions | str  | 否       | 设备描述                                                         |
| Measure_LowerLimit   | str  | 否       | 测点数据下限值，默认为空                                         |
| Measure_UpperLimit   | str  | 否       | 测点数据上限值，默认为空                                         |
| Measure_Icon_Nomal   | str  | 是       | 图标的URL，正常显示                                              |
| Measure_Icon_Overrun | str  | 是       | 图标的URL,超限时显示                                             |

**返回参数**

测点Measure_ID

### 2.2.2获取设备最新运行状态

**URL**

/api/devstateRT

**请求方法**

GET

**请求参数**

| 参数名 | 类型 | 是否必须 | 参数说明                                 |
|--------|------|----------|------------------------------------------|
| Usr_ID | str  | 否       | 默认本用户                               |
| Dev_ID | str  | 是       | 设备id，默认为空，返回所有设备信息，不为 |

**返回参数**

| 参数名          | 类型 | 参数说明                                         |
|-----------------|------|--------------------------------------------------|
| Dev_SwitchState | Str  | 设备运行状态,'0':'关机','1':'运行', '2':'未确定' |

### 2.2.3导入设备测点（excel）

**URL**

/api/measurePoints_import

**请求方法**

POST

**请求参数**

| 参数名              | 类型 | 是否必须 | 参数说明     |
|---------------------|------|----------|--------------|
| Dev_ID              | str  | 是       |              |
| MeasurePoints_Datas | file | 是       | xlsx格式文件 |

**返回参数**

### 2.3获取设备配置参数

**URL**

/api/devs \#获取所有设备配置信息

**请求方法**

GET

**请求参数**

| 参数名          | 类型 | 是否必须 | 参数说明                                                                  |
|-----------------|------|----------|---------------------------------------------------------------------------|
| Per_Page_Counts | str  | 否       | 分页每页显示数，默认10                                                    |
| Page_Counts     | str  | 否       | 页码，默认0                                                               |
| Search_Where    | str  | 否       | 搜索字段，指定获取单个设备时无效                                          |
| Dev_ID          | str  | 是       | 设备id，默认为空，返回所有设备信息，不为                                  |
| Dev_Brand       | str  | 否       | 返回符合品牌的设备，不传默认返回所有品牌（本公司品牌名’Usr_Description’） |

**返回参数**

| 参数名            | 类型 | 参数说明                           |
|-------------------|------|------------------------------------|
| Dev_Name          | Str  | 设备名称                           |
| Dev_State         | str  | 网关运行状态，1在线，0离线，-1故障 |
| Dev_Real_State    | str  | 设备状态 1开机0关机                |
| Dev_Description   | str  | 设备描述                           |
| Dev_ID            | str  | 设备id                             |
| DevCreate_Time    | str  | 记录创建时间                       |
| DevUpdate_Time    | str  | 记录修改时间                       |
| LONGITUDE         | str  | 实时经度                           |
| LATITUDE          | str  | 实时纬度                           |
| Station_longitude | str  | 基站经度                           |
| Station_latitude  | str  | 基站纬度                           |
| Dev_Brand         | str  | 设备品牌                           |
| Timestamp         | str  | 最新数据时间                       |
| Dev_Push          | str  | 设备使用者                         |

### 2.3.1 设备派发

**URL**

/api/**distribute_devs**

**请求方法**

POST

**请求参数**

| 参数名   | 类型 | 是否必须 | 参数说明               |
|----------|------|----------|------------------------|
| Dev_ID   | str  | 是       | 设备id，多个用'，'隔开 |
| Dev_Push | str  | 是       | 设备使用者             |

**返回参数**

### 2.4获取设备测点配置参数

**URL**

/api/measurePoints 获取指定设备的所有测点信息

**请求方法**

GET

**请求参数**

| 参数名            | 类型 | 是否必须 | 参数说明                                           |
|-------------------|------|----------|----------------------------------------------------|
| Usr_ID            | str  | 否       | 默认本用户                                         |
| Dev_ID            | str  | 是       | 设备id                                             |
| Per_Page_Counts   | str  | 否       | 分页每页显示数，默认10                             |
| Page_Counts       | str  | 否       | 页码，默认0                                        |
| Search_Where      | str  | 否       | 搜索字段，指定获取单个时无效                       |
| Measure_State_Now | str  | 否       | 返回测点即时状态，数据，图标，值为'1'才返回，默认1 |

**返回参数**

| 参数名               | 类型 | 参数说明                                                         |
|----------------------|------|------------------------------------------------------------------|
| Measure_Name         | str  | 测点名称                                                         |
| MeasureDataFlow_Name | str  | 测点数据流名称                                                   |
| Measure_Unit         | str  | 数据单位                                                         |
| MeasureCreate_Time   | str  | 测点创建时间                                                     |
| MeasureUpdate_Time   | str  | 测点最后修改时间                                                 |
| Measure_State        | str  | 测点状态 ，'2'表示有数据但是保存出错                             |
| Measure_Description  | str  | 测点描述                                                         |
| Measure_ID           | str  | 测点ID                                                           |
| Measure_Icon_Nomal   | str  | 测点图标URL                                                      |
| Measure_Icon_Overrun | str  | 测点图标URL超限                                                  |
| Measure_DataType     | str  | 测点数据类型，0：状态值；1：数据值                               |
| Measure_TotalState   | str  |                                                                  |
| Measure_SwitchState  | str  | '1'表示该测点为开关测点，默认为'0',已有开关测点添加值为'1'会失败 |
| Measure_LowerLimit   | str  |                                                                  |
| Total_Amount         | str  |                                                                  |
| Measure_UpperLimit   | str  |                                                                  |
| Measure_LineColor    | str  |                                                                  |

### 2.4.1获取设备测点实时信息

**URL**

/api/measurePointsRT

**请求方法**

GET

**请求参数**

| 参数名        | 类型 | 是否必须 | 参数说明                                 |
|---------------|------|----------|------------------------------------------|
| Usr_ID        | str  | 否       | 默认本用户                               |
| Dev_ID        | str  | 是       | 设备id                                   |
| Measure_Names | str  | 否       | 显示测点表，默认所有测点数据，以逗号隔开 |

**返回参数**

| 参数名        | 类型 | 参数说明    |
|---------------|------|-------------|
| Measure_Name  | str  | 测点名称    |
| Measure_Data  | str  | 测点数据    |
| Measure_Unit  | str  | 数据单位    |
| Measure_State | str  | 测点状态    |
| Measure_Icon  | str  | 测点图标URL |

### 2.5获取设备记录数据

**URL**

/api/devsdatas 获取指定设备的记录

**请求方法**

GET

**请求参数**

| 参数名          | 类型 | 是否必须 | 参数说明                                                          |
|-----------------|------|----------|-------------------------------------------------------------------|
| Usr_ID          | str  | 否       | 默认本用户                                                        |
| Start_Date      | str  | 否       | 默认当天0点，格式："2019-04-01 13:53:59"，指定timestamp,id时无效  |
| End_Date        | str  | 否       | 默认当前时间，格式："2019-04-01 13:53:59"，指定timestamp,id时无效 |
| Measure_Names   | str  | 否       | 显示测点表，默认所有测点数据，以逗号隔开                          |
| Order_By        | str  | 否       | 默认以TimeStamp排序                                               |
| Order_Way       | str  | 否       | ‘asc’,’desc’,默认asc                                              |
| Limits          | str  | 否       | 数据条数，默认所有                                                |
| Dev_ID          | str  | 是       | 设备id                                                            |
| Timestamp       | str  | 否       | 指定单条数据，格式"2019-04-01 13:53:59"                           |
| Per_Page_Counts | int  | 否       | 默认10                                                            |
| Page_Counts     | int  | 否       | 默认0代表所有                                                     |

**返回参数**

| 参数名            | 类型 | 参数说明  |
|-------------------|------|-----------|
| ......            | str  | 测点1数据 |
| ......            | Str  | 测点2数据 |
| LONGITUDE         | str  | 实时经度  |
| LATITUDE          | str  | 实时纬度  |
| Station_longitude | str  | 基站经度  |
| Station_latitude  | str  | 基站纬度  |
| Timestamp         | str  | 时间      |

### 2.5.1获取设备全天记录数据

**URL**

/api/devsdaydatas 获取指定设备的记录

**请求方法**

GET

**请求参数**

| 参数名        | 类型 | 是否必须 | 参数说明                                    |
|---------------|------|----------|---------------------------------------------|
| Usr_ID        | str  | 否       | 默认本用户                                  |
| Start_Date    | str  | 否       | 默认当天0点，格式："2019-04-01 00:00:00"，  |
| End_Date      | str  | 否       | 默认当天24点，格式："2019-04-01 23:53:59"， |
| Measure_Names | str  | 否       | 显示测点表，默认所有测点数据，以逗号隔开    |
| Order_By      | str  | 否       | 默认以TimeStamp排序                         |
| Order_Way     | str  | 否       | ‘asc’,’desc’,默认asc                        |
| Dev_ID        | str  | 是       | 设备id                                      |

**返回参数**

| 参数名    | 类型 | 参数说明  |
|-----------|------|-----------|
| ......    | str  | 测点1数据 |
| ......    | Str  | 测点2数据 |
| Timestamp | str  | 时间      |

### 2.5.2获取设备记录数据，地图显示

**URL**

/api/devsmapdatas 获取指定设备的记录

**请求方法**

GET

**请求参数**

| 参数名        | 类型 | 是否必须 | 参数说明                                                          |
|---------------|------|----------|-------------------------------------------------------------------|
| Usr_ID        | str  | 否       | 默认本用户                                                        |
| Start_Date    | str  | 否       | 默认当天0点，格式："2019-04-01 13:53:59"，指定timestamp,id时无效  |
| End_Date      | str  | 否       | 默认当前时间，格式："2019-04-01 13:53:59"，指定timestamp,id时无效 |
| Measure_Names | str  | 否       | 显示测点表，默认所有测点数据，以逗号隔开                          |
| Order_By      | str  | 否       | 默认以TimeStamp排序                                               |
| Order_Way     | str  | 否       | ‘asc’,’desc’,默认asc                                              |
| Limits        | str  | 否       | 数据条数，默认所有                                                |
| Dev_ID        | str  | 是       | 设备id                                                            |

**返回参数**

| 参数名            | 类型 | 参数说明      |
|-------------------|------|---------------|
| ......            | str  | 测点1数据     |
| ......            | Str  | 测点2数据     |
| LONGITUDE         | str  | 实时经度      |
| LATITUDE          | str  | 实时纬度      |
| Station_longitude | str  | 基站经度      |
| Station_latitude  | str  | 基站纬度      |
| Is_Fixed          | int  | 0,1 1：修正过 |
| Timestamp         | str  | 时间          |

### 2.6修改设备配置参数

**URL**

/api/devs/

**请求方法**

PUT

**请求参数（form）**

| 参数名          | 类型 | 是否必须 | 参数说明   |
|-----------------|------|----------|------------|
| Usr_ID          | str  | 否       | 默认本用户 |
| Dev_Name        | str  | 是       | 设备名     |
| Dev_ID          | str  | 是       | 设备唯一ID |
| Dev_Description | str  | 否       | 设备描述   |
| Old_Dev_ID      | str  | 是       | 原设备ID   |
| Dev_Brand       | str  | 否       | 所属品牌   |

**返回参数**

### 2.7修改设备测点，修改单个

**URL**

/api/measurePoints/

**请求方法**

PUT

**请求参数**

| 参数名               | 类型 | 是否必须 | 参数说明                                                         |
|----------------------|------|----------|------------------------------------------------------------------|
| Usr_ID               | str  | 否       | 默认本用户                                                       |
| Dev_ID               | str  | 是       | 设备id                                                           |
| Measure_ID           | str  | 是       | 测点主键id                                                       |
| Measure_Name         | str  | 是       | 测点名                                                           |
| MeasureDataFlow_Name | str  | 是       | 数据流名称                                                       |
| Measure_DataType     | str  | 是       | 测点数据类型，0：状态值；1：数据值                               |
| Measure_TotalState   | str  | 否       | 测点值统计，0：不记录；1：记录，默认0                            |
| Measure_SwitchState  | str  | 否       | '1'表示该测点为开关测点，默认为'0',已有开关测点添加值为'1'会失败 |
| Measure_Unit         | str  | 否       | 数据单位，默认为空                                               |
| Measure_Descriptions | str  | 否       | 设备描述                                                         |
| Measure_LowerLimit   | str  | 否       | 测点数据下限值，默认为空                                         |
| Measure_UpperLimit   | str  | 否       | 测点数据上限值，默认为空                                         |
| Measure_Icon_Nomal   | str  | 是       | 图标的URL                                                        |
| Measure_Icon_Overrun | str  | 是       | 图标的URL,超限                                                   |

**返回参数**

### 2.8删除设备测点，可删除多个（不删除表已有数据）

**URL**

/api/measurePoints

**请求方法**

DELETE

**请求参数**

| 参数名     | 类型 | 是否必须 | 参数说明                 |
|------------|------|----------|--------------------------|
| Usr_ID     | str  | 否       | 默认本用户               |
| Dev_ID     | str  | 是       | 设备主键id               |
| Measure_ID | str  | 是       | 测点主键id,多个用','相连 |

**返回参数**

### 2.9删除设备，（不删除表已有数据）

**URL**

/api/devs

**请求方法**

DELETE

**请求参数**

| 参数名 | 类型 | 是否必须 | 参数说明             |
|--------|------|----------|----------------------|
| Usr_ID | str  | 否       | 默认本用户           |
| Dev_ID | str  | 是       | 设备id,多个用','相连 |

**返回参数**

### 2.10利用mqtt控制设备

**URL**

/api/mqttcontroll

**请求方法**

POST

**请求参数**

| 参数名         | 类型 | 是否必须 | 参数说明                      |
|----------------|------|----------|-------------------------------|
| Usr_ID         | str  | 否       | 默认本用户                    |
| Dev_ID         | str  | 是       | 设备id                        |
| Operate_Number | str  | 是       | 操作码‘1’，‘2’，‘3’，‘4’，‘5’ |
| Send_Text      | str  | 否       | 透传内容                      |

**返回参数**

### 2.11获取图片

**URL**

/api/photos

**请求方法**

GET

**请求参数**

| 参数名    | 类型 | 是否必须 | 参数说明                                            |
|-----------|------|----------|-----------------------------------------------------|
| Usr_ID    | str  | 否       | 默认本用户                                          |
| Dev_ID    | str  | 是       | 设备id                                              |
| Timestamp | str  | 否       | 时间戳，格式"2019-04-01 13:53:59"，返回最近一张图片 |

**返回参数**

| 参数名    | 类型 | 参数说明 |
|-----------|------|----------|
| URL       | str  | 图片地址 |
| Timestamp | str  | 拍摄时间 |

### 2.12获取所有图标资源

**URL**

/api/icons

**请求方法**

GET

**请求参数**

**返回参数**

| 参数名    | 类型 | 参数说明                           |
|-----------|------|------------------------------------|
| Icon_Name | str  | 图标名称                           |
| Icon_URL  | str  | 图标地址                           |
| Icon_Type | str  | 图标类型，'1'表示蓝色，'0'表示红色 |

### 2.13发送获取网关当前配置请求

**URL**

/api/gateway

**请求方法**

POST

**请求参数**

| 参数名 | 类型 | 是否必须 | 参数说明   |
|--------|------|----------|------------|
| Usr_ID | str  | 否       | 默认本用户 |
| Dev_ID | str  | 是       | 设备id     |

**返回参数**

### 2.14查看获取网关当前配置结果

**URL**

/api/gateway

**请求方法**

GET

**请求参数**

| 参数名 | 类型 | 是否必须 | 参数说明   |
|--------|------|----------|------------|
| Usr_ID | str  | 否       | 默认本用户 |
| Dev_ID | str  | 是       | 设备id     |

**返回参数**

| 参数名     | 类型 | 参数说明                             |
|------------|------|--------------------------------------|
| Is_Success | str  | '1'获取成功,'0'获取失败,'-1'结果未知 |
| Message    | str  | 信息说明                             |

### 2.15发送升级网关请求

**URL**

/api/upgrade

**请求方法**

POST

**请求参数**

**返回参数**

### 2.16查看升级结果

**URL**

/api/upgrade

**请求方法**

GET

**请求参数**

**返回参数**

| 参数名     | 类型 | 参数说明                             |            |
|------------|------|--------------------------------------|------------|
| Usr_ID     | str  | 否                                   | 默认本用户 |
| Is_Success | str  | '1'升级成功,'0'升级失败,'-1'结果未知 |            |
| Message    | str  | 信息说明                             |            |

### 2.17 上传文件

**URL**

/api/upload

**请求方法**

POST

**请求参数**

**返回参数**

### 2.18 获取设备网关配置的更新信息

**URL**

/api/updatemsg

**请求方法**

GET

**请求参数**

| 参数名          | 类型 | 是否必须 | 参数说明                                 |
| --------------- | ---- | -------- | ---------------------------------------- |
| Usr_ID          | str  | 否       | 默认本用户                               |
| Per_Page_Counts | str  | 否       | 分页每页显示数，默认10                   |
| Page_Counts     | str  | 否       | 页码，默认0                              |
| Search_Where    | str  | 否       | 搜索字段，指定获取单个设备时无效         |
| Dev_ID          | str  | 否       | 设备id，默认为空，返回所有设备信息，不为 |

**返回参数**

| 参数名      | 类型 | 参数说明 |
| ----------- | ---- | -------- |
| Dev_ID      | str  | 设备ID   |
| Dev_Name    | str  | 设备名称 |
| Update_Time | str  | 更新时间 |

### 2.19 添加图标

**URL**

/api/icons

**请求方法**

POST（表单）

**请求参数**

| 参数名            | 类型 | 是否必须 | 参数说明             |
| ----------------- | ---- | -------- | -------------------- |
| Icon_Name         | str  | 是       | 图标名称             |
| Icon_File_Nomal   | file | 是       | 测点正常显示图标文件 |
| Icon_File_Overrun | file | 是       | 测点异常显示图标文件 |

**返回参数**

### 2.20 删除图标

**URL**

/api/icons

**请求方法**

DELETE

**请求参数**

| 参数名    | 类型 | 是否必须 | 参数说明 |
| --------- | ---- | -------- | -------- |
| Icon_Name | str  | 是       | 图标名称 |

**返回参数**

数据相关
------------

### 3.1 获取某时间段设备各个状态的总时间

**URL**

/api/statustime

**请求方法**

GET

**请求参数**

| 参数名     | 类型 | 是否必须 | 参数说明                                     |
|------------|------|----------|----------------------------------------------|
| Usr_ID     | str  | 否       | 默认本用户                                   |
| Start_Date | str  | 否       | 默认当天0点，格式："2019-04-01 13:53:59"，   |
| End_Date   | str  | 否       | 默认当天23:59，格式："2019-04-01 13:53:59"， |
| Dev_ID     | str  | 是       | 设备id                                       |

**返回参数**

| 参数名      | 类型 | 参数说明   |
|-------------|------|------------|
| Status_Name | str  | 设备状态名 |
| Total_Time  | str  | 总时间     |

### 3.2 获取某时间段设备的所有状态数据（简化，作图专用）

**URL**

/api/statuschartdatas

**请求方法**

GET

**请求参数**

| 参数名     | 类型 | 是否必须 | 参数说明                                   |
|------------|------|----------|--------------------------------------------|
| Usr_ID     | str  | 否       | 默认本用户                                 |
| Start_Date | str  | 否       | 默认当天0点，格式："2019-04-01 13:53:59"， |
| End_Date   | str  | 否       | 默认当天23:59，格式："2019-04-01 13:53:59" |
| Dev_ID     | str  | 是       | 设备id                                     |

**返回参数**

| 参数名      | 类型 | 参数说明                        |
|-------------|------|---------------------------------|
| Status_Name | str  | 设备状态名                      |
| Time        | str  | 时间，格式"2019-04-01 13:53:59" |
| Message     | str  | 异常时的提示信息，其他状态没有  |

### 3.3 获取设备所有状态判断规则

**URL**

/api/statusrule

**请求方法**

GET

**请求参数**

| 参数名 | 类型 | 是否必须 | 参数说明   |
|--------|------|----------|------------|
| Usr_ID | str  | 否       | 默认本用户 |
| Dev_ID | str  | 是       | 设备id     |

**返回参数**

| 参数名       | 类型 | 参数说明 |
|--------------|------|----------|
| id           | int  | 主键id   |
| Rule_Name    | str  | 规则名称 |
| Status_Name  | str  | 状态名称 |
| Measure_Name | str  | 测点名称 |
| Formula      | str  | 计算公式 |

### 3.4 添加状态判断规则

**URL**

/api/statusrule

**请求方法**

POST

**请求参数**

| 参数名       | 类型 | 是否必须 | 参数说明               |
|--------------|------|----------|------------------------|
| Usr_ID       | str  | 否       | 默认本用户             |
| Dev_ID       | str  | 是       | 设备id                 |
| Rule_Name    | str  | 是       | 规则名,例:'开机规则1'  |
| Status_Name  | str  | 是       | 状态名,例:'开机'       |
| Measure_Name | str  | 是       | 测点名                 |
| Formula      | str  | 是       | 公式，例:'100\<x\<200' |

**返回参数**

### 3.5 修改状态判断规则

**URL**

/api/statusrule

**请求方法**

PUT

**请求参数**

| 参数名       | 类型 | 是否必须 | 参数说明   |
|--------------|------|----------|------------|
| Usr_ID       | str  | 否       | 默认本用户 |
| id           | int  | 是       | 主键id     |
| Dev_ID       | str  | 是       | 设备id     |
| Rule_Name    | str  | 是       | 规则名     |
| Status_Name  | str  | 是       | 状态名     |
| Measure_Name | str  | 是       | 测点名     |
| Formula      | str  | 是       | 公式       |

**返回参数**

### 3.6 删除状态判断规则

**URL**

/api/statusrule

**请求方法**

DELETE

**请求参数**

| 参数名 | 类型 | 是否必须 | 参数说明   |
|--------|------|----------|------------|
| Usr_ID | str  | 否       | 默认本用户 |
| id     | int  | 是       | 主键id     |
| Dev_ID | str  | 是       | 设备id     |

**返回参数**

### 3.7 获取某月有数据的天

**URL**

/api/date_with_data

**请求方法**

GET

**请求参数**

| 参数名 | 类型 | 是否必须 | 参数说明 |
| ------ | ---- | -------- | -------- |
| Time   | str  | 是       | 某月     |
| Dev_ID | str  | 是       |          |

**返回参数**

| 参数名    | 类型 | 参数说明 |
| --------- | ---- | -------- |
| Date_List | list | 日期合集 |

附录Ⅰ
---------

项目开发名词说明

|      | 缩写                 | 说明                                                                                                      |
|------|----------------------|-----------------------------------------------------------------------------------------------------------|
| 用户 | Usr_Name             | 用户名称                                                                                                  |
|      | Usr_Password         | 用户密码                                                                                                  |
|      | Usr_ID               | 用户ID                                                                                                    |
|      | Usr_Email            | 用户邮箱                                                                                                  |
|      | Usr_Phone            | 用户联系方式                                                                                              |
|      | Usr_Company          | 用户公司名称                                                                                              |
|      | Usr_Description      | 用户描述                                                                                                  |
|      | is_active            | 用户状态，是否激活，在线，离线                                                                            |
|      | Usr_MQTT_Password    | 用户MQTT密码                                                                                              |
|      | Usr_MQTT_Subject     | 用户MQTT主题                                                                                              |
| 设备 | Dev_ID               | 设备ID                                                                                                    |
|      | Old_Dev_ID           | 原设备ID                                                                                                  |
|      | Dev_Name             | 设备名称                                                                                                  |
|      | DevCreate_Time       | 设备创建时间                                                                                              |
|      | DevUpdate_Time       | 设备修改时间                                                                                              |
|      | Dev_State            | 设备运行状态                                                                                              |
|      | Dev_Description      | 设备描述                                                                                                  |
| 测点 | Measure_ID           | 测点ID                                                                                                    |
|      | Measure_Name         | 测点名称                                                                                                  |
|      | MeasureDataFlow_Name | 测点数据流名称                                                                                            |
|      | Measure_Unit         | 测点单位                                                                                                  |
|      | MeasureCreate_Time   | 测点创建时间                                                                                              |
|      | MeasureUpdate_Time   | 测点修改时间                                                                                              |
|      | Measure_State        | 测点状态                                                                                                  |
|      | Measure_Description  | 测点描述                                                                                                  |
|      | Measure_DataType     | 测点数据类型，0：状态值；1：数据值                                                                        |
|      | Measure_TotalState   | 测点值统计，0：不记录；1：记录                                                                            |
|      | Measure_LowerLimit   | 测点数据下限值                                                                                            |
|      | Measure_UpperLimit   | 测点数据上限值                                                                                            |
|      | Measure_Icon         | 测点图标                                                                                                  |
|      | Measure_SwitchState  | 表示设备运行的测点                                                                                        |
| 请求 | Sreach_Where         | 搜索条件，字段名                                                                                          |
|      | Per_Page_Counts      | 每页显示条数，默认10                                                                                      |
|      | Page_Counts          | 页数，默认1                                                                                               |
|      | Start_Date           | 开始时间，格式："2019-04-01 13:53:59"，指定Timestamp时无效                                                |
|      | End_Date             | 结束时间，格式："2019-04-01 13:53:59"，指定Timestamp时无效                                                |
|      | Measure_Names        | 要查询的测点名称，以逗号隔开                                                                              |
|      | Order_By             | 排序名称                                                                                                  |
|      | Order_Way            | 排序方式‘asc’,’desc’,默认asc                                                                              |
|      | Limits               | 请求数量，默认为所有数据                                                                                  |
|      | Timestamp            | 指定单个时间的一条数据，格式"2019-04-01 13:53:59"，如果这个时间没有数据，就返回这之前时间最接近的一条数据 |
| 返回 | Measure_Name1...n    | 测点名称                                                                                                  |
|      | Station_ongitude     | 2G模块的基站经度                                                                                          |
|      | Station_latitude     | 2G模块的基站纬度                                                                                          |
|      |                      | 返回数据的总条数                                                                                          |
|      |                      | 图片URL                                                                                                   |
|      | Err_No               | 返回码                                                                                                    |
|      | Err_Msg              | 返回信息                                                                                                  |
|      | Data                 | 返回数据                                                                                                  |
| 操作 | Operate_Number       | 操作码，‘1’，‘2’，‘3’，‘4’,‘5’                                                                            |
|      | Send_Text            | 发送内容，透传                                                                                            |

附录Ⅱ 
------

告警信息说明

| Err_No | 说明 |
|--------|------|
| 0      | 正常 |
| 1      | 告警 |
| \-1    | 异常 |

附录Ⅲ 
------

日志信息说明

| 级别    | Err_Msg      |
|---------|--------------|
| error   | 获取数据失败 |
| error   | xx操作失败   |
| warning | SIM卡异常    |
| success | xx操作成功   |
| info    | 用户登录     |
| info    | 用户退出     |

附录Ⅳ 
------

通用状态码说明

| Err_NO | Err_Msg                  |
|--------|--------------------------|
| 4001   | 数据库查询出错           |
| 4002   | 无数据                   |
| 4003   | 数据已存在               |
| 4004   | 数据错误                 |
| 4101   | 用户未登录               |
| 4102   | 用户登录失败             |
| 4103   | 参数错误                 |
| 4104   | 用户不存在               |
| 4105   | 用户权限不足             |
| 4106   | 密码错误                 |
| 4107   | 数据库记录新增或修改出错 |
| 4201   | 非法请求或请求次数受限   |
| 4202   | IP受限                   |
| 4302   | 文件读写错误             |
| 4501   | 未知错误                 |
